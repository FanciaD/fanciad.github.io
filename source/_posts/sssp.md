---
title: '[paper] Negative Weight SSSP'
date: '2024-12-02 18:23:08'
updated: '2024-12-02 18:23:08'
tags: Fancia
permalink: RingonoNegoto/
description: Negative Weight SSSP
mathjax: true
---

### Directed SSSP

首先我们假设：

1. 如果一个点有负权出边，那么它只有一条出边。
2. 度数均匀。

![122-1](\pic\122-1.png)



考虑如下问题：当前有 $k$ 条负权边，我们希望找到一个 $\phi(u)$，使得把边权变为 $w_{u,v}+\phi(u)-\phi(v)$ 后，负权边数量减少了。



可行的操作：每次只拿出正权边跑 Dijkstra，然后只拿出负权边。这样 $k$ 轮能解决所有经过不超过 $k$ 条负权边的路径。



定义 $^h$ 就表示只考虑经过不超过 $h$ 条负权边的路径的情况。定义 $R^h(u)$ 表示有多少个点在 $^h$ 下和 $u$ 之间某个方向有负权路径。

在搞过来一个 $\phi$ 的时候，我们要求：

1. 非负边必须还是非负边。
2. 负边可以变成非负边（毕竟最后都得是非负边），但一轮里面 $^h$ 按照最初的正负计算。



每一轮，我们搞过来一个 $\phi$，使得一些负边变成非负边。这样足够多轮之后，它们就全部变成了非负边。



#### Hop Reduction

如果我们建造一个图 $H$，使得 $d_G^r\geq d_H^1\geq d_G$，那我们在 $H$ 里面算最短路就只需要考虑 $^{n/r}$ 的情况。

平凡的构造：复制 $r$ 份图，负权边放在一份到下一份里面，然后设置 $\phi$ 使得只有最后一份连回来的边是负的。可以发现 $\phi=d^i(V,u)$ 是可行的。



注意到如果有很多个点的 $d^{r}(V,u)=0$，那每个这样的点的复制可以被合并。所以只要存在 $n/r$ 个这样的点，复杂度（因为度数均匀）就是 $\tilde O(nm/r)$。更进一步，$n$ 可以换成负权边数量。



#### Negative Sandwich

怎么说明一个点反向出发走 $^d$ 不会遇到负权路径？简化的条件是，从所有负权边端点开始走（记这个点集为 $U$），$d$ 步内不存在到 $u$ 的负权路径。



假设 $\phi(U)=0$，我们希望尽量多的点满足 $\phi(s)\leq d^\beta(U,s)$。

问题是 $d^\beta(U,u\in U)$ 也可以是负数，这就急了。

我们考虑找一个东西，它在 $u\in U$ 上是正数，但在别的点上尽量是 $d^\beta(U,s)$。结果是：$\min(d^\beta(U,s),-d^\beta(s,U))$：反向两次得到的还是正常三角形不等式。它对于 $d^\beta(U,s)+d^\beta(s,U)\geq 0$ 的东西都是好的。我们有一个类似的定义：



Betweenness$^\beta(u,v)$：有多少个点 $x$，使得 $d^\beta(u,x)+d^{\beta}(x,v)<0$。



但这里是两个集合。因此我们考虑拿一个点管住 $U$，得到如下定义：



Negative Sandwich：一组 $(x,U,y)$，满足 $d^1(x,u\in U)\leq 0,d^1(u\in U,y)\leq 0$。



这样我们只需要考虑 Betweenness$^{\beta+1}(x,y)$（跳一次），且上面那个边权设置就是合法的。



#### Betweenness Reduction



Betweenness$^\beta(u,v)$：有多少个点 $x$，使得 $d^\beta(u,x)+d^{\beta}(x,v)<0$。



我们希望减小这个值。一个想法：

如果我们随机 $O(r\log n)$ 个点，然后让经过每个点 $x$ 的 $(u,x,v)$ 都满足 $\geq0$ 的条件，那 whp 整个东西就很小（random hitting set）



首先考虑一个点怎么做：给一个 $x$，我们希望给一个 $\varphi$ 使得所有 $d^\beta(u,x)+d^\beta(x,v)\geq 0$。

这很像普通的 Reweighting: 先假装我们把 $n^2$ 条边都建出来，那随便跑一个最短路就能给出答案（或者找到负环），那也可以只建 $2n$ 条边，表示 $d^\beta(u,x),(x,v)$，然后跑最短路。



但直接最短路太慢了，有没有更好的观察？

1. 我们可以只用这些 $d^\beta(u,x),(x,v)$ 的边。

证明：三角形不等式的部分是显然的，但我们还需要保证正权边合法。此时有两种手法：把正权边加进去，或者发现 $d^\beta(x,v)\leq d^\beta(x,u)+w(u,v)$，所以无论 $u$ 的最短路哪来的，$v$ 的最短路都不会太小。

2. 经过上一步之后，合法的最短路只经过 $\leq 2$ 条负权边。

证明：它们都和 $x$ 相连。



那我们在这一部分上跑新的 $d^2$ 即可。一般情况类似变成 $d^{2r\log n}$，复杂度 $\tilde O(\beta rm+r^2n)$。此时BW变成了 $n/r$ 级别。



#### Sandwich Construction

考虑一半的情况：找到一个 $x$ 和尽量大的 $U$，使得 $d^1(x,u\in U)<0$。

怎么对于一个 $x$ 算这个值？随机 sample U，多源最短路（有环就寄）我们就能估计大小！

那如果全部很小会发生啥？如果每一个都小于 $\sqrt {|U|}$，那我们随机采样可以找到 $O(\sqrt {|U|})$ 个点，它们两两满足 $d^1>0$。



##### Solve Independent Set

此时很简单：对于每条负权边，增大 $\phi(u)$，然后往前通过正权值减下去。$d^1>0$ 保证不会影响别的负权边。



那我们做两次，把两边都构造出来。最后要么我们得到一个 $U^{1/3}$ 的 Sandwich，要么得到这么大的 $d^1$-independent set。

#### Altogether

考虑上面的一堆东西，找到 Sandwich 后，复杂度是：

1. Hop Reduction: $|U|^{1/3}/r(m+r*BW^r(r))$
2. BW reduction: 如果 $BW^r$ 是 $n/r$，则需要 $mr^2$

那么 $r=u^{1/9}$，复杂度 $\tilde O( mr^2=mu^{2/9})$



每一轮复杂度 $u^{2/9}$，删掉 $u^{-2/3}$ 数量的边。总复杂度 $\tilde O(mn^{8/9})$